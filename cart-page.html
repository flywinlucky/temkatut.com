<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
    <meta name="keywords" content="cadouri, jucÄƒrii, accesorii, idei de cadouri, gift house, produse pentru cadouri, decoraÈ›iuni, surprize, seturi cadou, articole pentru ocazii speciale">
    <meta name="author" content="Gift House">
    <meta name="description" content="Gift House este un magazin online specializat Ã®n cadouri, jucÄƒrii È™i accesorii. DescoperÄƒ cele mai frumoase idei de cadouri pentru toate ocaziile!">
    
   
    <link rel="icon" href="images/logowhite.jpg" type="image/x-icon">
    <!-- css -->

    <link rel="stylesheet" href="Style/cartPage.css">
    <link rel="stylesheet" href="Style/main.css">
    <link rel="stylesheet" href="Style/chatBot.css">

    <!-- Google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap"
        rel="stylesheet">
    <!-- icon -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <title>Gift House</title>
</head>

<body>
    <header class="container" id="header">
        <div class="header_top">
            <img src="images/logo_block.png" alt="page logo" id="logo" onclick="window.location.href='index.html'">

            <nav id="navbar">
                <menu>
                    <ul class="nav-buttons">
                        <li><a href="index.html">Acasa</a></li>
                        <li><a href="products.html">Produse</a></li>
                    </ul>
                </menu>
            </nav>

            <div class="header_actions">
                <a href="https://t.me/jewelryady">
                    <ion-icon name="call-outline"></ion-icon>
                </a>
                <a href="#" class="icon-cart">
                    <ion-icon name="cart-outline"></ion-icon>
                    <span id="cart-counter">0</span>
                </a>
            </div>
        </div>

    </header>
    <main class="cart_page">
        <div class="container">

            <div class="content">
                <div class="left_side_cart">
                    <div class="cart_title">
                        <h2>.</h2>
                        <h2>Produsele Mele <span id="cart_counts"></span></h2>
                    </div>
                    <div class="cart_products">
                        <!-- add cart products in js -->
                    </div>
                </div>
                <div class="right_side_cart">
                    <div class="Promotional_code">

                        <div class="Shiping_Info">
                            <p>.</p>
                            <h2>InformaÈ›ii de contact</h2>
                            <input type="text" placeholder="Nume / Prenume" id="shippingName">
                            <input type="text" placeholder="Telefon" id="shippingPhone">
                            <input type="email" placeholder="E-mail" id="shippingEmail">
                            <input type="text" placeholder="Telegram / Viber / Whatsapp" id="shippingTelegram">
                        </div>

                        <div class="Shiping_Info">
                            <h2>OpÅ£iuni de livrare</h2>
                            <input type="text" placeholder="Raion" id="shippingRaion">
                            <input type="text" placeholder="Oras" id="shippingOras">
                            <input type="text" placeholder="Adresa" id="shippingAdresa">
                            <input type="text" placeholder="Codul Postal" id="shippingPostalCode">
                        </div>

                        <div class="text-message-center">
                            <h1>Metode de platÄƒ</h1>
                            <div class="payment-method">
                                <label>
                                    <input type="radio" name="payment" value="cash" onclick="togglePaymentButton();">
                                    Achitare numerar
                                </label>
                                <label>
                                    <input type="radio" name="payment" value="card" onclick="togglePaymentButton();">
                                    Achitare cu cardul
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="summary">

                        <div class="summary_price">
                            <h2 class="center-text">Rezumatul comenzii</h2>
                            <div>
                                <h4>Subtotal</h4>
                                <span id="Subtotal"></span>
                            </div>
                            <div class="Delivery">
                                <h4>Livrare</h4>
                                <span id="Delivery">0 MDL</span>
                            </div>
                            <div>
                                <h4>Comanda totalÄƒ</h4>
                                <span id="total_order"></span>
                            </div>
                            <div>
                                <h4>Subtotal In USD</h4>
                                <span id="total_order_usd">0 USD</span>
                            </div>
                        </div>
                        <button class="checkout" id="checkoutButton" onclick="checkOut();">PLASEAZA COMANDA</button>
                        <button class="checkout" id="freekassaButton" style="display: none;"
                            onclick="processCardOrder();">Plateste cu FREEKASSA</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Cart Overlay -->
    <div class="cart-overlay" onclick="closeCart();"></div>

    <!-- Cart Section -->
    <div class="cart-section">
        <div class="cart-header">
            <h2>CoÈ™ de cumpÄƒrÄƒturi</h2>
            <div class="closeCart" onclick="closeCart();">
                <ion-icon name="close-outline"></ion-icon>
            </div>
        </div>
        <div class="cart_products">
            <!-- add cart products in js -->
        </div>
        <div class="cart_total">
            <h3>Total:</h3>
            <span id="total_price"></span>
        </div>
        <div class="btn_control">
            <button class="viewCart" onclick="viewCart();">Vezi coÈ™ul</button>
            <button class="checkout" onclick="viewCart();">CumpÄƒrÄƒ</button>
        </div>
    </div>

    <footer class="footer black-footer">
        <div class="footer-top">
            <div class="footer-list">

                <div class="list">
                    <h4>INFORMATII</h4>
                    <ul>
                        <!--<li><a href="despre-noi.html">Despre noi</a></li>-->
                        <li><a href="contacte.html">Contacte</a></li>
                    </ul>
                </div>
                <div class="list">
                    <h4>RELATII CLIENTI</h4>
                    <ul>
                        <li><a href="termeni-si-conditii.html">Termeni si conditii</a></li>
                        <li><a href="politica-de-confidentialitate.html">Politica de confidentialitate</a></li>
                    </ul>
                </div>

            </div>
        </div>
        <div class="footer-bottom">

                   <!--<div class="header_social">
                <a href="https://www.instagram.com/jewelryady/" target="_blank">
                    <img src="images/footer/Insta_Icon.png" alt="Instagram">
                </a>
                <a href="https://t.me/jewelryady" target="_blank">
                    <img src="images/footer/telegram_Icon.png" alt="Telegram">
                </a>
                <a href="https://wa.me/+373069956253" target="_blank">
                    <img src="images/footer/whatsapp_Icon.png" alt="WhatsApp">
                </a>
            </div>-->

            <p class="footer-company-name">
                Â© 2025 Toate drepturile rezervate.
            </p>
        </div>
    </footer>
    <button id="scrollBtn"><ion-icon name="arrow-up-outline" id="btn-up"></ion-icon></button>

    <!-- Chat Bot -->
    <div class="overlay" id="overlay"></div>
    <button class="chat-button" id="chatButton" onclick="toggleChat()">
        <img id="chatIcon" src="images/Chat Bot/Chat On.png" alt="Chat Icon" style="width: 100%; height: auto;">
    </button>

    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            Consultant (Online)
            <button class="close-button" onclick="toggleChat()">Ã—</button>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="chat-message message-bot">
                ðŸ‘‹ BunÄƒ ziua! Cum vÄƒ putem ajuta?
            </div>
        </div>
        <div class="preset-buttons">
            <button class="preset-button" onclick="sendPresetMessage('ÃŽn cÃ¢te zile ajunge livrarea?')">ÃŽn cÃ¢te zile
                ajunge livrarea?</button>
            <button class="preset-button"
                onclick="sendPresetMessage('Care sunt opÈ›iunile de livrare disponibile?')">Care sunt opÈ›iunile de
                livrare disponibile?</button>
            <button class="preset-button" onclick="sendPresetMessage('Cum pot sÄƒ urmÄƒresc statusul comenzii mele?')">Cum
                pot sÄƒ urmÄƒresc statusul comenzii mele?</button>
            <button class="preset-button"
                onclick="sendPresetMessage('Achitarea se efectueazÄƒ la primire sau cu cardul?')">Achitarea se efectueazÄƒ
                la primire sau cu cardul?</button>
        </div>
    </div>

    <script src="JavaScript/main.js"></script>
    <script src="JavaScript/cart.js"></script>
    <script src="JavaScript/chatBotCore.js"></script>
    <script>
        function togglePaymentButton() {
            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
            const checkoutButton = document.getElementById('checkoutButton');
            const freekassaButton = document.getElementById('freekassaButton');

            if (paymentMethod === 'cash') {
                checkoutButton.style.display = 'block';
                checkoutButton.disabled = false;
                freekassaButton.style.display = 'none';
            } else if (paymentMethod === 'card') {
                checkoutButton.style.display = 'none';
                freekassaButton.style.display = 'block';
            }
        }

        function checkOut() {
            const paymentMethod = document.querySelector('input[name="payment"]:checked');
            if (!paymentMethod) {
                alert("VÄƒ rugÄƒm sÄƒ selectaÈ›i o metodÄƒ de platÄƒ.");
                return;
            }

            const shippingName = document.getElementById('shippingName').value.trim();
            const shippingPhone = document.getElementById('shippingPhone').value.trim();
            const shippingEmail = document.getElementById('shippingEmail').value.trim();
            const shippingTelegram = document.getElementById('shippingTelegram').value.trim();
            const shippingRaion = document.getElementById('shippingRaion').value.trim();
            const shippingOras = document.getElementById('shippingOras').value.trim();
            const shippingAdresa = document.getElementById('shippingAdresa').value.trim();
            const shippingPostalCode = document.getElementById('shippingPostalCode').value.trim();

            if (!shippingName || !shippingPhone || !shippingEmail || !shippingTelegram || !shippingRaion || !shippingOras || !shippingAdresa || !shippingPostalCode) {
                alert("VÄƒ rugÄƒm sÄƒ completaÈ›i toate cÃ¢mpurile de livrare.");
                return;
            }

            if (paymentMethod.value === 'cash') {
                processCashOrder();
            } else if (paymentMethod.value === 'card') {
                processCardOrder();
            }
        }

        function processCashOrder() {
            // Preluarea informaÈ›iilor de livrare
            let shippingInfo = {
                Nume: document.getElementById('shippingName').value,
                Telefon: document.getElementById('shippingPhone').value,
                Email: document.getElementById('shippingEmail').value,
                Telegram: document.getElementById('shippingTelegram').value,
                Raion: document.getElementById('shippingRaion').value,
                Oras: document.getElementById('shippingOras').value,
                Adresa: document.getElementById('shippingAdresa').value,
                CodulPostal: document.getElementById('shippingPostalCode').value
            };

            // Generarea timestamp-ului
            let currentDate = new Date();
            let formattedDate = `${currentDate.toLocaleDateString()} | ${currentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true })}`;

            // Crearea mesajului de comandÄƒ
            let orderDetails = `Detalii ComandÄƒ:\nItemi:\nData ${formattedDate}\n\n`;
            cart.forEach((product, index) => {
                orderDetails += `${index + 1}) ${product.name} | Cantitate x${product.quantity} | ${product.size && product.size !== "MÄƒrime necunoscutÄƒ" ? `MÄƒrime ${product.size}` : ''}\nImagine: ${product.images[0]}\n\n`;
            });

            let totalOrderPrice = `${updateTotalPrice().toFixed(2)} MDL`;
            orderDetails += `Total: ${totalOrderPrice}\n\n`;
            orderDetails += `Nume: ${shippingInfo.Nume}\n`;
            orderDetails += `Telefon: ${shippingInfo.Telefon}\n`;
            orderDetails += `Email: ${shippingInfo.Email}\n`;
            orderDetails += `Telegram: ${shippingInfo.Telegram}\n`;
            orderDetails += `Raion: ${shippingInfo.Raion}\n`;
            orderDetails += `Oras: ${shippingInfo.Oras}\n`;
            orderDetails += `Adresa: ${shippingInfo.Adresa}\n`;
            orderDetails += `Codul Postal: ${shippingInfo.CodulPostal}`;

            // Save order details to localStorage
            localStorage.setItem("orderDetails", orderDetails);

            // Trimiterea mesajului prin Telegram API
            const telegramApiUrls = [
                `https://api.telegram.org/bot7566897555:AAG-7T_y31rmY5Adtwz3d8oxdTo2uNXuj-U/sendMessage?chat_id=6953089880&text=${encodeURIComponent(orderDetails)}`
            ];

            Promise.all(telegramApiUrls.map(url => fetch(url)))
                .then(responses => {
                    if (responses.every(response => response.ok)) {
                         //alert("Comanda a fost plasatÄƒ cu succes!");
                        window.location.href = "payment-successful.html";
                    } else {
                         //alert("Eroare la plasarea comenzii. VÄƒ rugÄƒm sÄƒ Ã®ncercaÈ›i din nou.");
                    }
                })
                .catch(error => {
                    console.error("Eroare la trimiterea detaliilor comenzii:", error);
                    window.location.href = "payment-failed.html";
                });
        }

        async function processCardOrder() {
            const totalOrderPriceMDL = updateTotalPrice().toFixed(2);
            const totalOrderPriceUSD = await convertToUSD(totalOrderPriceMDL);

            const merchantId = '60399';
            const secretWord1 = 'A2^NvFJm]c6]!m8';
            const orderId = new Date().getTime(); // Unique order ID
            const signature = md5(`${merchantId}:${totalOrderPriceUSD}:${secretWord1}:${orderId}`);

            alert(`FreeKassa Parameters:\nMerchant ID: ${merchantId}\nAmount in USD: ${totalOrderPriceUSD}\nOrder ID: ${orderId}\nSignature: ${signature}`);

            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://pay.freekassa.ru/';
            form.target = '_blank';

            const params = {
                m: merchantId,
                oa: totalOrderPriceUSD,
                o: orderId,
                s: signature,
                currency: 'USD',
                us_user: 'USER_ID',
                lang: 'en',
                i: 'USD',
                debug: '1'
            };

            for (const key in params) {
                if (params.hasOwnProperty(key)) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = params[key];
                    form.appendChild(input);
                }
            }

            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form); // Remove the form after submission
        }

        function md5(string) {
            return CryptoJS.MD5(string).toString();
        }
    </script>
</body>

</html>